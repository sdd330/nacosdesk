# å‘½åç©ºé—´ç®¡ç† API æµ‹è¯•ç”¨ä¾‹

> **API è·¯å¾„å‰ç¼€**: `/nacos/v1/console/namespaces`  
> **æµ‹è¯•æ–‡ä»¶**: `src-tauri/src/server/tests/namespace_tests.rs`

---

## 1. å‘½åç©ºé—´åˆ—è¡¨ API (`GET /v1/console/namespaces`)

### 1.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šè·å–å‘½åç©ºé—´åˆ—è¡¨
- **æµ‹è¯•å‡½æ•°å**: `test_list_namespaces_success`
- **å‰ç½®æ¡ä»¶**:
  - åˆ›å»ºæµ‹è¯•æ•°æ®åº“
  - æ’å…¥å¤šä¸ªå‘½åç©ºé—´ï¼š
    - `namespace_id=public`, `namespace_name=Public`
    - `namespace_id=test-ns-1`, `namespace_name=Test Namespace 1`
    - `namespace_id=test-ns-2`, `namespace_name=Test Namespace 2`
- **è¯·æ±‚**:
  - æ–¹æ³•: `GET`
  - URI: `/nacos/v1/console/namespaces`
- **é¢„æœŸå“åº”**:
  - çŠ¶æ€ç : `200 OK`
  - å“åº”ä½“: JSON æ ¼å¼ï¼ŒåŒ…å«å‘½åç©ºé—´åˆ—è¡¨
- **éªŒè¯ç‚¹**:
  - å“åº”çŠ¶æ€ç ä¸º 200
  - è¿”å›æ‰€æœ‰å‘½åç©ºé—´
  - åŒ…å«å‘½åç©ºé—´ IDã€åç§°ã€æè¿°ç­‰ä¿¡æ¯

#### æµ‹è¯•ç”¨ä¾‹ï¼šåŒ…å«é»˜è®¤ public å‘½åç©ºé—´
- **æµ‹è¯•å‡½æ•°å**: `test_list_namespaces_includes_public`
- **å‰ç½®æ¡ä»¶**: åˆ›å»ºæµ‹è¯•æ•°æ®åº“ï¼ˆé»˜è®¤ public å‘½åç©ºé—´åº”å­˜åœ¨ï¼‰
- **éªŒè¯ç‚¹**: è¿”å›çš„åˆ—è¡¨ä¸­åŒ…å« public å‘½åç©ºé—´

#### æµ‹è¯•ç”¨ä¾‹ï¼šå¤šä¸ªå‘½åç©ºé—´çš„æƒ…å†µ
- **æµ‹è¯•å‡½æ•°å**: `test_list_namespaces_multiple`
- **å‰ç½®æ¡ä»¶**: æ’å…¥å¤šä¸ªå‘½åç©ºé—´
- **éªŒè¯ç‚¹**: è¿”å›æ‰€æœ‰å‘½åç©ºé—´ï¼Œæ•°é‡æ­£ç¡®

---

## 2. å‘½åç©ºé—´åˆ›å»º API (`POST /v1/console/namespaces`)

### 2.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šåˆ›å»ºæ–°å‘½åç©ºé—´ï¼ˆæˆåŠŸï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_create_namespace_success`
- **å‰ç½®æ¡ä»¶**: åˆ›å»ºæµ‹è¯•æ•°æ®åº“
- **è¯·æ±‚**:
  - æ–¹æ³•: `POST`
  - URI: `/nacos/v1/console/namespaces`
  - Body: JSON `{"customNamespaceId":"test-ns","namespaceName":"Test Namespace","namespaceDesc":"Test Description"}`
- **é¢„æœŸå“åº”**:
  - çŠ¶æ€ç : `200 OK` æˆ– `201 Created`
  - å“åº”ä½“: `true` æˆ–æˆåŠŸæ¶ˆæ¯
- **éªŒè¯ç‚¹**:
  - å“åº”çŠ¶æ€ç æ­£ç¡®
  - æ•°æ®åº“ä¸­å‘½åç©ºé—´å·²åˆ›å»º
  - å‘½åç©ºé—´ IDã€åç§°ã€æè¿°æ­£ç¡®

#### æµ‹è¯•ç”¨ä¾‹ï¼šåˆ›å»ºå·²å­˜åœ¨çš„å‘½åç©ºé—´ï¼ˆé”™è¯¯å¤„ç†ï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_create_namespace_already_exists`
- **å‰ç½®æ¡ä»¶**: æ’å…¥æµ‹è¯•å‘½åç©ºé—´ï¼š`namespace_id=test-ns`
- **è¯·æ±‚**: ä½¿ç”¨ç›¸åŒçš„ `customNamespaceId`
- **é¢„æœŸå“åº”**: `400 Bad Request` æˆ– `409 Conflict`
- **éªŒè¯ç‚¹**: è¿”å›é”™è¯¯çŠ¶æ€ç å’Œé”™è¯¯æ¶ˆæ¯

#### æµ‹è¯•ç”¨ä¾‹ï¼šå‘½åç©ºé—´åç§°å’Œæè¿°è®¾ç½®
- **æµ‹è¯•å‡½æ•°å**: `test_create_namespace_with_name_and_desc`
- **è¯·æ±‚**: Body åŒ…å« `namespaceName` å’Œ `namespaceDesc`
- **éªŒè¯ç‚¹**: åç§°å’Œæè¿°æ­£ç¡®ä¿å­˜

---

## 3. å‘½åç©ºé—´æ›´æ–° API (`PUT /v1/console/namespaces`)

### 3.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ›´æ–°å‘½åç©ºé—´ä¿¡æ¯
- **æµ‹è¯•å‡½æ•°å**: `test_update_namespace_success`
- **å‰ç½®æ¡ä»¶**: æ’å…¥æµ‹è¯•å‘½åç©ºé—´
- **è¯·æ±‚**:
  - æ–¹æ³•: `PUT`
  - URI: `/nacos/v1/console/namespaces`
  - Body: JSON `{"namespace":"test-ns","namespaceShowName":"Updated Name","namespaceDesc":"Updated Description"}`
- **é¢„æœŸå“åº”**: `200 OK`
- **éªŒè¯ç‚¹**: å‘½åç©ºé—´ä¿¡æ¯å·²æ›´æ–°

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ›´æ–°ä¸å­˜åœ¨çš„å‘½åç©ºé—´ï¼ˆ404ï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_update_namespace_not_found`
- **å‰ç½®æ¡ä»¶**: åˆ›å»ºæµ‹è¯•æ•°æ®åº“ï¼ˆä¸æ’å…¥å‘½åç©ºé—´ï¼‰
- **è¯·æ±‚**: æ›´æ–°ä¸å­˜åœ¨çš„å‘½åç©ºé—´
- **é¢„æœŸå“åº”**: `404 Not Found`
- **éªŒè¯ç‚¹**: è¿”å› 404 çŠ¶æ€ç 

---

## 4. å‘½åç©ºé—´åˆ é™¤ API (`DELETE /v1/console/namespaces`)

### 4.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šåˆ é™¤å‘½åç©ºé—´ï¼ˆæˆåŠŸï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_delete_namespace_success`
- **å‰ç½®æ¡ä»¶**:
  - åˆ›å»ºæµ‹è¯•æ•°æ®åº“
  - æ’å…¥æµ‹è¯•å‘½åç©ºé—´ï¼š`namespace_id=test-ns`
- **è¯·æ±‚**:
  - æ–¹æ³•: `DELETE`
  - URI: `/nacos/v1/console/namespaces?namespaceId=test-ns`
- **é¢„æœŸå“åº”**:
  - çŠ¶æ€ç : `200 OK`
  - å“åº”ä½“: `true`
- **éªŒè¯ç‚¹**:
  - å“åº”çŠ¶æ€ç ä¸º 200
  - æ•°æ®åº“ä¸­å‘½åç©ºé—´å·²åˆ é™¤

#### æµ‹è¯•ç”¨ä¾‹ï¼šåˆ é™¤ä¸å­˜åœ¨çš„å‘½åç©ºé—´ï¼ˆ404ï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_delete_namespace_not_found`
- **å‰ç½®æ¡ä»¶**: åˆ›å»ºæµ‹è¯•æ•°æ®åº“ï¼ˆä¸æ’å…¥å‘½åç©ºé—´ï¼‰
- **è¯·æ±‚**: `DELETE /nacos/v1/console/namespaces?namespaceId=non-existent`
- **é¢„æœŸå“åº”**: `404 Not Found`
- **éªŒè¯ç‚¹**: è¿”å› 404 çŠ¶æ€ç 

#### æµ‹è¯•ç”¨ä¾‹ï¼šåˆ é™¤å‘½åç©ºé—´åé…ç½®å’ŒæœåŠ¡ä¹Ÿè¢«åˆ é™¤
- **æµ‹è¯•å‡½æ•°å**: `test_delete_namespace_cascades_resources`
- **å‰ç½®æ¡ä»¶**:
  - æ’å…¥æµ‹è¯•å‘½åç©ºé—´ï¼š`namespace_id=test-ns`
  - æ’å…¥é…ç½®ï¼š`tenant=test-ns`
  - æ’å…¥æœåŠ¡ï¼š`namespace_id=test-ns`
  - æ’å…¥å®ä¾‹ï¼š`namespace_id=test-ns`
- **æ­¥éª¤**:
  1. åˆ é™¤å‘½åç©ºé—´
  2. æŸ¥è¯¢é…ç½®åˆ—è¡¨
  3. æŸ¥è¯¢æœåŠ¡åˆ—è¡¨
  4. æŸ¥è¯¢å®ä¾‹åˆ—è¡¨
- **éªŒè¯ç‚¹**: 
  - é…ç½®å·²åˆ é™¤ï¼ˆçº§è”åˆ é™¤ï¼‰
  - æœåŠ¡å·²åˆ é™¤ï¼ˆçº§è”åˆ é™¤ï¼‰
  - å®ä¾‹å·²åˆ é™¤ï¼ˆçº§è”åˆ é™¤ï¼‰

#### æµ‹è¯•ç”¨ä¾‹ï¼šåˆ é™¤ public å‘½åç©ºé—´ï¼ˆé”™è¯¯å¤„ç†ï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_delete_namespace_public_forbidden`
- **å‰ç½®æ¡ä»¶**: public å‘½åç©ºé—´å­˜åœ¨
- **è¯·æ±‚**: `DELETE /nacos/v1/console/namespaces?namespaceId=public`
- **é¢„æœŸå“åº”**: `400 Bad Request` æˆ– `403 Forbidden`
- **éªŒè¯ç‚¹**: è¿”å›é”™è¯¯çŠ¶æ€ç ï¼Œpublic å‘½åç©ºé—´ä¸èƒ½è¢«åˆ é™¤

---

## ğŸ“ æµ‹è¯•å®ç°æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•æ•°æ®å‡†å¤‡**:
   - ä½¿ç”¨ `TestDatabase::new()` åˆ›å»ºæµ‹è¯•æ•°æ®åº“
   - ä½¿ç”¨ `insert_test_namespace()` æ’å…¥æµ‹è¯•å‘½åç©ºé—´
   - public å‘½åç©ºé—´é€šå¸¸é»˜è®¤å­˜åœ¨

2. **è¯·æ±‚æ„å»º**:
   - POST/PUT è¯·æ±‚éœ€è¦ JSON Body
   - DELETE è¯·æ±‚ä½¿ç”¨ URL å‚æ•°

3. **å“åº”éªŒè¯**:
   - éªŒè¯çŠ¶æ€ç 
   - éªŒè¯å“åº”ä½“æ ¼å¼å’Œå†…å®¹
   - éªŒè¯æ•°æ®åº“çŠ¶æ€ï¼ˆå¯é€‰ï¼‰

4. **æ¸…ç†**:
   - ä½¿ç”¨ `test_db.cleanup()` æ¸…ç†æµ‹è¯•æ•°æ®

5. **å‘½åç©ºé—´éš”ç¦»**:
   - éªŒè¯ä¸åŒå‘½åç©ºé—´çš„é…ç½®å’ŒæœåŠ¡ç›¸äº’éš”ç¦»
   - åˆ é™¤å‘½åç©ºé—´æ—¶åº”çº§è”åˆ é™¤ç›¸å…³èµ„æº

6. **public å‘½åç©ºé—´ç‰¹æ®Šå¤„ç†**:
   - public å‘½åç©ºé—´æ˜¯é»˜è®¤å‘½åç©ºé—´ï¼Œé€šå¸¸ä¸èƒ½è¢«åˆ é™¤
   - tenant å‚æ•°ä¸ºç©ºå­—ç¬¦ä¸²æ—¶è¡¨ç¤º public å‘½åç©ºé—´

---

**æœ€åæ›´æ–°**: 2025-01-27

