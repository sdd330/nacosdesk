# å®ä¾‹ç®¡ç† API æµ‹è¯•ç”¨ä¾‹

> **API è·¯å¾„å‰ç¼€**: `/nacos/v1/ns/instance`  
> **æµ‹è¯•æ–‡ä»¶**: `src-tauri/src/server/tests/instance_tests.rs`

---

## 1. å®ä¾‹æ³¨å†Œ API (`POST /v1/ns/instance`)

### 1.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ³¨å†Œæ–°å®ä¾‹ï¼ˆæˆåŠŸï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_register_instance_success`
- **å‰ç½®æ¡ä»¶**:
  - åˆ›å»ºæµ‹è¯•æ•°æ®åº“
  - æ’å…¥æµ‹è¯•æœåŠ¡ï¼š`service_name=test-service`, `namespace_id=public`, `group_name=DEFAULT_GROUP`
- **è¯·æ±‚**:
  - æ–¹æ³•: `POST`
  - URI: `/nacos/v1/ns/instance?ip=127.0.0.1&port=8080&serviceName=test-service&namespaceId=public&groupName=DEFAULT_GROUP`
  - Body: å¯é€‰ JSONï¼ˆå…ƒæ•°æ®ã€æƒé‡ç­‰ï¼‰
- **é¢„æœŸå“åº”**:
  - çŠ¶æ€ç : `200 OK`
  - å“åº”ä½“: `ok`
- **éªŒè¯ç‚¹**:
  - å“åº”çŠ¶æ€ç ä¸º 200
  - æ•°æ®åº“ä¸­å®ä¾‹å·²åˆ›å»º

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ³¨å†Œå·²å­˜åœ¨çš„å®ä¾‹ï¼ˆæ›´æ–°ï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_register_instance_update_existing`
- **å‰ç½®æ¡ä»¶**:
  - æ’å…¥æµ‹è¯•æœåŠ¡
  - æ’å…¥æµ‹è¯•å®ä¾‹ï¼š`ip=127.0.0.1`, `port=8080`
- **è¯·æ±‚**: ä½¿ç”¨ç›¸åŒçš„ IP å’Œç«¯å£æ³¨å†Œ
- **é¢„æœŸå“åº”**: `200 OK`
- **éªŒè¯ç‚¹**: å®ä¾‹ä¿¡æ¯å·²æ›´æ–°ï¼ˆä¸æ˜¯åˆ›å»ºæ–°å®ä¾‹ï¼‰

#### æµ‹è¯•ç”¨ä¾‹ï¼šä¸åŒå‘½åç©ºé—´å’Œ Group
- **æµ‹è¯•å‡½æ•°å**: `test_register_instance_different_namespace_and_group`
- **å‰ç½®æ¡ä»¶**: æ’å…¥å¤šä¸ªæœåŠ¡å’Œå‘½åç©ºé—´
- **æµ‹è¯•åœºæ™¯**:
  1. `namespaceId=public&groupName=DEFAULT_GROUP`
  2. `namespaceId=test-ns&groupName=custom-group`
- **éªŒè¯ç‚¹**: æ¯ä¸ªç»„åˆéƒ½èƒ½æ­£ç¡®æ³¨å†Œå®ä¾‹

#### æµ‹è¯•ç”¨ä¾‹ï¼šå®ä¾‹å…ƒæ•°æ®è®¾ç½®
- **æµ‹è¯•å‡½æ•°å**: `test_register_instance_with_metadata`
- **è¯·æ±‚**: Body åŒ…å«å…ƒæ•°æ® JSONï¼Œä¾‹å¦‚ï¼š`{"metadata":{"key":"value"}}`
- **éªŒè¯ç‚¹**: å…ƒæ•°æ®æ­£ç¡®ä¿å­˜

#### æµ‹è¯•ç”¨ä¾‹ï¼šå®ä¾‹æƒé‡è®¾ç½®
- **æµ‹è¯•å‡½æ•°å**: `test_register_instance_with_weight`
- **è¯·æ±‚**: åŒ…å« `weight` å‚æ•°ï¼Œä¾‹å¦‚ï¼š`weight=0.5`
- **éªŒè¯ç‚¹**: æƒé‡æ­£ç¡®ä¿å­˜

#### æµ‹è¯•ç”¨ä¾‹ï¼šä¸´æ—¶å®ä¾‹å’ŒæŒä¹…å®ä¾‹
- **æµ‹è¯•å‡½æ•°å**: `test_register_instance_ephemeral_vs_persistent`
- **æµ‹è¯•åœºæ™¯**:
  1. `ephemeral=true`ï¼šä¸´æ—¶å®ä¾‹
  2. `ephemeral=false`ï¼šæŒä¹…å®ä¾‹
- **éªŒè¯ç‚¹**: å®ä¾‹ç±»å‹æ­£ç¡®è®¾ç½®

### 1.2 å‚æ•°éªŒè¯æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šç¼ºå°‘å¿…éœ€å‚æ•° ip
- **æµ‹è¯•å‡½æ•°å**: `test_register_instance_missing_ip`
- **è¯·æ±‚**: ä¸åŒ…å« `ip` å‚æ•°
- **é¢„æœŸå“åº”**: `400 Bad Request`
- **éªŒè¯ç‚¹**: è¿”å›é”™è¯¯çŠ¶æ€ç 

#### æµ‹è¯•ç”¨ä¾‹ï¼šç¼ºå°‘å¿…éœ€å‚æ•° port
- **æµ‹è¯•å‡½æ•°å**: `test_register_instance_missing_port`
- **è¯·æ±‚**: ä¸åŒ…å« `port` å‚æ•°
- **é¢„æœŸå“åº”**: `400 Bad Request`
- **éªŒè¯ç‚¹**: è¿”å›é”™è¯¯çŠ¶æ€ç 

#### æµ‹è¯•ç”¨ä¾‹ï¼šç¼ºå°‘å¿…éœ€å‚æ•° serviceName
- **æµ‹è¯•å‡½æ•°å**: `test_register_instance_missing_service_name`
- **è¯·æ±‚**: ä¸åŒ…å« `serviceName` å‚æ•°
- **é¢„æœŸå“åº”**: `400 Bad Request`
- **éªŒè¯ç‚¹**: è¿”å›é”™è¯¯çŠ¶æ€ç 

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ— æ•ˆçš„ IP åœ°å€
- **æµ‹è¯•å‡½æ•°å**: `test_register_instance_invalid_ip`
- **æµ‹è¯•åœºæ™¯**:
  1. `ip=invalid-ip`
  2. `ip=999.999.999.999`
- **é¢„æœŸå“åº”**: `400 Bad Request`
- **éªŒè¯ç‚¹**: è¿”å›é”™è¯¯çŠ¶æ€ç 

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ— æ•ˆçš„ç«¯å£å·
- **æµ‹è¯•å‡½æ•°å**: `test_register_instance_invalid_port`
- **æµ‹è¯•åœºæ™¯**:
  1. `port=-1`
  2. `port=65536`
  3. `port=abc`
- **é¢„æœŸå“åº”**: `400 Bad Request`
- **éªŒè¯ç‚¹**: è¿”å›é”™è¯¯çŠ¶æ€ç 

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ— æ•ˆçš„æƒé‡å€¼
- **æµ‹è¯•å‡½æ•°å**: `test_register_instance_invalid_weight`
- **æµ‹è¯•åœºæ™¯**:
  1. `weight=-1`ï¼ˆè´Ÿæ•°ï¼‰
  2. `weight=2.0`ï¼ˆè¶…è¿‡1.0ï¼‰
- **é¢„æœŸå“åº”**: `400 Bad Request` æˆ–ä½¿ç”¨é»˜è®¤å€¼
- **éªŒè¯ç‚¹**: æ ¹æ®å®ç°éªŒè¯è¡Œä¸º

---

## 2. å®ä¾‹æ›´æ–° API (`PUT /v1/ns/instance`)

### 2.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ›´æ–°å®ä¾‹ä¿¡æ¯ï¼ˆæƒé‡ã€å…ƒæ•°æ®ã€å¥åº·çŠ¶æ€ï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_update_instance_success`
- **å‰ç½®æ¡ä»¶**: æ’å…¥æµ‹è¯•å®ä¾‹
- **è¯·æ±‚**:
  - æ–¹æ³•: `PUT`
  - URI: `/nacos/v1/ns/instance?ip=127.0.0.1&port=8080&serviceName=test-service&namespaceId=public&groupName=DEFAULT_GROUP`
  - Body: JSON åŒ…å«æ›´æ–°å­—æ®µï¼ˆweight, metadata, healthy ç­‰ï¼‰
- **é¢„æœŸå“åº”**: `200 OK`
- **éªŒè¯ç‚¹**: å®ä¾‹ä¿¡æ¯å·²æ›´æ–°

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ›´æ–°ä¸å­˜åœ¨çš„å®ä¾‹ï¼ˆ404ï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_update_instance_not_found`
- **å‰ç½®æ¡ä»¶**: åˆ›å»ºæµ‹è¯•æ•°æ®åº“ï¼ˆä¸æ’å…¥å®ä¾‹ï¼‰
- **è¯·æ±‚**: æ›´æ–°ä¸å­˜åœ¨çš„å®ä¾‹
- **é¢„æœŸå“åº”**: `404 Not Found`
- **éªŒè¯ç‚¹**: è¿”å› 404 çŠ¶æ€ç 

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ›´æ–°åå®ä¾‹ä¿¡æ¯æ­£ç¡®
- **æµ‹è¯•å‡½æ•°å**: `test_update_instance_verify_changes`
- **å‰ç½®æ¡ä»¶**: æ’å…¥æµ‹è¯•å®ä¾‹
- **æ­¥éª¤**:
  1. æ›´æ–°å®ä¾‹æƒé‡ä¸º 0.8
  2. æŸ¥è¯¢å®ä¾‹è¯¦æƒ…
- **éªŒè¯ç‚¹**: æƒé‡å·²æ›´æ–°ä¸º 0.8

---

## 3. å®ä¾‹æ³¨é”€ API (`DELETE /v1/ns/instance`)

### 3.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ³¨é”€å­˜åœ¨çš„å®ä¾‹ï¼ˆæˆåŠŸï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_deregister_instance_success`
- **å‰ç½®æ¡ä»¶**:
  - åˆ›å»ºæµ‹è¯•æ•°æ®åº“
  - æ’å…¥æµ‹è¯•æœåŠ¡
  - æ’å…¥æµ‹è¯•å®ä¾‹
- **è¯·æ±‚**:
  - æ–¹æ³•: `DELETE`
  - URI: `/nacos/v1/ns/instance?ip=127.0.0.1&port=8080&serviceName=test-service&namespaceId=public&groupName=DEFAULT_GROUP`
- **é¢„æœŸå“åº”**:
  - çŠ¶æ€ç : `200 OK`
  - å“åº”ä½“: `ok`
- **éªŒè¯ç‚¹**:
  - å“åº”çŠ¶æ€ç ä¸º 200
  - æ•°æ®åº“ä¸­å®ä¾‹å·²åˆ é™¤

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ³¨é”€ä¸å­˜åœ¨çš„å®ä¾‹ï¼ˆ404ï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_deregister_instance_not_found`
- **å‰ç½®æ¡ä»¶**: åˆ›å»ºæµ‹è¯•æ•°æ®åº“ï¼ˆä¸æ’å…¥å®ä¾‹ï¼‰
- **è¯·æ±‚**: `DELETE /nacos/v1/ns/instance?ip=127.0.0.1&port=8080&serviceName=test-service&namespaceId=public&groupName=DEFAULT_GROUP`
- **é¢„æœŸå“åº”**: `404 Not Found`
- **éªŒè¯ç‚¹**: è¿”å› 404 çŠ¶æ€ç 

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ³¨é”€åå®ä¾‹ä»æœåŠ¡ä¸­ç§»é™¤
- **æµ‹è¯•å‡½æ•°å**: `test_deregister_instance_removed_from_service`
- **å‰ç½®æ¡ä»¶**:
  - æ’å…¥æµ‹è¯•æœåŠ¡
  - æ’å…¥å¤šä¸ªå®ä¾‹
- **æ­¥éª¤**:
  1. æ³¨é”€ä¸€ä¸ªå®ä¾‹
  2. æŸ¥è¯¢æœåŠ¡å®ä¾‹åˆ—è¡¨
- **éªŒè¯ç‚¹**: å®ä¾‹å·²ä»åˆ—è¡¨ä¸­ç§»é™¤

---

## 4. å®ä¾‹æŸ¥è¯¢ API (`GET /v1/ns/instance`)

### 4.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šæŸ¥è¯¢å­˜åœ¨çš„å®ä¾‹ï¼ˆæˆåŠŸï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_get_instance_success`
- **å‰ç½®æ¡ä»¶**:
  - åˆ›å»ºæµ‹è¯•æ•°æ®åº“
  - æ’å…¥æµ‹è¯•æœåŠ¡
  - æ’å…¥æµ‹è¯•å®ä¾‹
- **è¯·æ±‚**:
  - æ–¹æ³•: `GET`
  - URI: `/nacos/v1/ns/instance?ip=127.0.0.1&port=8080&serviceName=test-service&namespaceId=public&groupName=DEFAULT_GROUP`
- **é¢„æœŸå“åº”**:
  - çŠ¶æ€ç : `200 OK`
  - å“åº”ä½“: JSON æ ¼å¼ï¼ŒåŒ…å«å®ä¾‹è¯¦æƒ…
- **éªŒè¯ç‚¹**:
  - å“åº”çŠ¶æ€ç ä¸º 200
  - å®ä¾‹è¯¦æƒ…ä¿¡æ¯å®Œæ•´

#### æµ‹è¯•ç”¨ä¾‹ï¼šæŸ¥è¯¢ä¸å­˜åœ¨çš„å®ä¾‹ï¼ˆ404ï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_get_instance_not_found`
- **å‰ç½®æ¡ä»¶**: åˆ›å»ºæµ‹è¯•æ•°æ®åº“ï¼ˆä¸æ’å…¥å®ä¾‹ï¼‰
- **è¯·æ±‚**: `GET /nacos/v1/ns/instance?ip=127.0.0.1&port=8080&serviceName=test-service&namespaceId=public&groupName=DEFAULT_GROUP`
- **é¢„æœŸå“åº”**: `404 Not Found`
- **éªŒè¯ç‚¹**: è¿”å› 404 çŠ¶æ€ç 

#### æµ‹è¯•ç”¨ä¾‹ï¼šå®ä¾‹è¯¦æƒ…ä¿¡æ¯å®Œæ•´æ€§
- **æµ‹è¯•å‡½æ•°å**: `test_get_instance_details_complete`
- **éªŒè¯ç‚¹**: å®ä¾‹è¯¦æƒ…åŒ…å«ï¼š
  - IP å’Œç«¯å£
  - æƒé‡
  - å¥åº·çŠ¶æ€
  - å…ƒæ•°æ®
  - å®ä¾‹ç±»å‹ï¼ˆä¸´æ—¶/æŒä¹…ï¼‰
  - æœ€åå¿ƒè·³æ—¶é—´

---

## 5. å®ä¾‹åˆ—è¡¨ API (`GET /v1/ns/instance/list`)

### 5.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šè·å–æœåŠ¡çš„å®ä¾‹åˆ—è¡¨
- **æµ‹è¯•å‡½æ•°å**: `test_list_instances_success`
- **å‰ç½®æ¡ä»¶**:
  - æ’å…¥æµ‹è¯•æœåŠ¡
  - æ’å…¥å¤šä¸ªå®ä¾‹
- **è¯·æ±‚**: `GET /nacos/v1/ns/instance/list?serviceName=test-service&namespaceId=public&groupName=DEFAULT_GROUP`
- **é¢„æœŸå“åº”**:
  - çŠ¶æ€ç : `200 OK`
  - å“åº”ä½“: JSON æ ¼å¼ï¼ŒåŒ…å«å®ä¾‹åˆ—è¡¨
- **éªŒè¯ç‚¹**: è¿”å›æ‰€æœ‰å®ä¾‹

#### æµ‹è¯•ç”¨ä¾‹ï¼šè¿‡æ»¤å¥åº·å®ä¾‹
- **æµ‹è¯•å‡½æ•°å**: `test_list_instances_filter_healthy`
- **å‰ç½®æ¡ä»¶**: æ’å…¥å¥åº·å’Œä¸å¥åº·çš„å®ä¾‹
- **è¯·æ±‚**: åŒ…å« `healthyOnly=true` å‚æ•°ï¼ˆå¦‚æœæ”¯æŒï¼‰
- **éªŒè¯ç‚¹**: åªè¿”å›å¥åº·å®ä¾‹

#### æµ‹è¯•ç”¨ä¾‹ï¼šè¿‡æ»¤ä¸å¥åº·å®ä¾‹
- **æµ‹è¯•å‡½æ•°å**: `test_list_instances_filter_unhealthy`
- **å‰ç½®æ¡ä»¶**: æ’å…¥å¥åº·å’Œä¸å¥åº·çš„å®ä¾‹
- **è¯·æ±‚**: åŒ…å«è¿‡æ»¤å‚æ•°ï¼ˆå¦‚æœæ”¯æŒï¼‰
- **éªŒè¯ç‚¹**: åªè¿”å›ä¸å¥åº·å®ä¾‹

#### æµ‹è¯•ç”¨ä¾‹ï¼šç©ºå®ä¾‹åˆ—è¡¨
- **æµ‹è¯•å‡½æ•°å**: `test_list_instances_empty`
- **å‰ç½®æ¡ä»¶**: æ’å…¥æµ‹è¯•æœåŠ¡ï¼ˆæ— å®ä¾‹ï¼‰
- **è¯·æ±‚**: åŒä¸Š
- **é¢„æœŸå“åº”**: ç©ºåˆ—è¡¨
- **éªŒè¯ç‚¹**: è¿”å›ç©ºåˆ—è¡¨

---

## 6. å®ä¾‹å¿ƒè·³ API (`PUT /v1/ns/instance/beat`)

### 6.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šå‘é€å¿ƒè·³ï¼ˆæˆåŠŸï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_instance_heartbeat_success`
- **å‰ç½®æ¡ä»¶**: æ’å…¥æµ‹è¯•å®ä¾‹
- **è¯·æ±‚**:
  - æ–¹æ³•: `PUT`
  - URI: `/nacos/v1/ns/instance/beat?serviceName=test-service&namespaceId=public&groupName=DEFAULT_GROUP`
  - Body: JSON `{"ip":"127.0.0.1","port":8080,"beat":{"clientBeatInterval":5000}}`
- **é¢„æœŸå“åº”**:
  - çŠ¶æ€ç : `200 OK`
  - å“åº”ä½“: JSON åŒ…å«å¿ƒè·³é—´éš”ç­‰ä¿¡æ¯
- **éªŒè¯ç‚¹**: å¿ƒè·³å‘é€æˆåŠŸ

#### æµ‹è¯•ç”¨ä¾‹ï¼šå¿ƒè·³æ›´æ–°å®ä¾‹æœ€åå¿ƒè·³æ—¶é—´
- **æµ‹è¯•å‡½æ•°å**: `test_instance_heartbeat_updates_time`
- **å‰ç½®æ¡ä»¶**: æ’å…¥æµ‹è¯•å®ä¾‹
- **æ­¥éª¤**:
  1. è®°å½•å½“å‰æ—¶é—´
  2. å‘é€å¿ƒè·³
  3. æŸ¥è¯¢å®ä¾‹è¯¦æƒ…
- **éªŒè¯ç‚¹**: æœ€åå¿ƒè·³æ—¶é—´å·²æ›´æ–°

#### æµ‹è¯•ç”¨ä¾‹ï¼šå¿ƒè·³ä¿æŒå®ä¾‹å¥åº·çŠ¶æ€
- **æµ‹è¯•å‡½æ•°å**: `test_instance_heartbeat_maintains_health`
- **å‰ç½®æ¡ä»¶**: æ’å…¥æµ‹è¯•å®ä¾‹
- **æ­¥éª¤**:
  1. è®¾ç½®å®ä¾‹ä¸ºä¸å¥åº·
  2. å‘é€å¿ƒè·³
  3. æŸ¥è¯¢å®ä¾‹å¥åº·çŠ¶æ€
- **éªŒè¯ç‚¹**: å®ä¾‹æ¢å¤å¥åº·çŠ¶æ€

#### æµ‹è¯•ç”¨ä¾‹ï¼šå¿ƒè·³ä¸å­˜åœ¨çš„å®ä¾‹ï¼ˆé”™è¯¯å¤„ç†ï¼‰
- **æµ‹è¯•å‡½æ•°å**: `test_instance_heartbeat_not_found`
- **å‰ç½®æ¡ä»¶**: åˆ›å»ºæµ‹è¯•æ•°æ®åº“ï¼ˆä¸æ’å…¥å®ä¾‹ï¼‰
- **è¯·æ±‚**: å‘é€å¿ƒè·³
- **é¢„æœŸå“åº”**: `404 Not Found` æˆ– `400 Bad Request`
- **éªŒè¯ç‚¹**: è¿”å›é”™è¯¯çŠ¶æ€ç 

---

## 7. å®ä¾‹éƒ¨åˆ†æ›´æ–° API (`PATCH /v1/ns/instance`)

### 7.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šéƒ¨åˆ†æ›´æ–°å®ä¾‹å…ƒæ•°æ®
- **æµ‹è¯•å‡½æ•°å**: `test_patch_instance_metadata`
- **å‰ç½®æ¡ä»¶**: æ’å…¥æµ‹è¯•å®ä¾‹
- **è¯·æ±‚**:
  - æ–¹æ³•: `PATCH`
  - URI: `/nacos/v1/ns/instance?ip=127.0.0.1&port=8080&serviceName=test-service&namespaceId=public&groupName=DEFAULT_GROUP`
  - Body: JSON `{"metadata":{"newKey":"newValue"}}`
- **é¢„æœŸå“åº”**: `200 OK`
- **éªŒè¯ç‚¹**: å…ƒæ•°æ®å·²æ›´æ–°ï¼ˆå…¶ä»–å­—æ®µä¸å˜ï¼‰

#### æµ‹è¯•ç”¨ä¾‹ï¼šéƒ¨åˆ†æ›´æ–°å®ä¾‹æƒé‡
- **æµ‹è¯•å‡½æ•°å**: `test_patch_instance_weight`
- **å‰ç½®æ¡ä»¶**: æ’å…¥æµ‹è¯•å®ä¾‹
- **è¯·æ±‚**: Body åŒ…å« `weight` å­—æ®µ
- **éªŒè¯ç‚¹**: æƒé‡å·²æ›´æ–°ï¼ˆå…¶ä»–å­—æ®µä¸å˜ï¼‰

#### æµ‹è¯•ç”¨ä¾‹ï¼šéƒ¨åˆ†æ›´æ–°å®ä¾‹å¥åº·çŠ¶æ€
- **æµ‹è¯•å‡½æ•°å**: `test_patch_instance_healthy`
- **å‰ç½®æ¡ä»¶**: æ’å…¥æµ‹è¯•å®ä¾‹
- **è¯·æ±‚**: Body åŒ…å« `healthy` å­—æ®µ
- **éªŒè¯ç‚¹**: å¥åº·çŠ¶æ€å·²æ›´æ–°ï¼ˆå…¶ä»–å­—æ®µä¸å˜ï¼‰

---

## 8. å®ä¾‹æ‰¹é‡æ“ä½œ API

### 8.1 æ‰¹é‡æ›´æ–°å…ƒæ•°æ® (`PUT /v1/ns/instance/metadata/batch`)

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ‰¹é‡æ›´æ–°å¤šä¸ªå®ä¾‹çš„å…ƒæ•°æ®
- **æµ‹è¯•å‡½æ•°å**: `test_batch_update_instance_metadata_success`
- **å‰ç½®æ¡ä»¶**: æ’å…¥å¤šä¸ªæµ‹è¯•å®ä¾‹
- **è¯·æ±‚**:
  - æ–¹æ³•: `PUT`
  - URI: `/nacos/v1/ns/instance/metadata/batch`
  - Body: JSON åŒ…å«å¤šä¸ªå®ä¾‹çš„å…ƒæ•°æ®æ›´æ–°ä¿¡æ¯
- **é¢„æœŸå“åº”**: `200 OK`
- **éªŒè¯ç‚¹**: æ‰€æœ‰å®ä¾‹çš„å…ƒæ•°æ®å·²æ›´æ–°

#### æµ‹è¯•ç”¨ä¾‹ï¼šéƒ¨åˆ†å®ä¾‹ä¸å­˜åœ¨çš„æƒ…å†µ
- **æµ‹è¯•å‡½æ•°å**: `test_batch_update_instance_metadata_partial_failure`
- **å‰ç½®æ¡ä»¶**: æ’å…¥éƒ¨åˆ†å®ä¾‹
- **è¯·æ±‚**: åŒ…å«å­˜åœ¨å’Œä¸å­˜åœ¨çš„å®ä¾‹
- **é¢„æœŸå“åº”**: `200 OK` æˆ– `207 Multi-Status`ï¼ˆéƒ¨åˆ†æˆåŠŸï¼‰
- **éªŒè¯ç‚¹**: å­˜åœ¨çš„å®ä¾‹å·²æ›´æ–°ï¼Œä¸å­˜åœ¨çš„å®ä¾‹è¿”å›é”™è¯¯

### 8.2 æ‰¹é‡åˆ é™¤å…ƒæ•°æ® (`DELETE /v1/ns/instance/metadata/batch`)

#### æµ‹è¯•ç”¨ä¾‹ï¼šæ‰¹é‡åˆ é™¤å¤šä¸ªå®ä¾‹çš„å…ƒæ•°æ®
- **æµ‹è¯•å‡½æ•°å**: `test_batch_delete_instance_metadata_success`
- **å‰ç½®æ¡ä»¶**: æ’å…¥å¸¦å…ƒæ•°æ®çš„å¤šä¸ªå®ä¾‹
- **è¯·æ±‚**:
  - æ–¹æ³•: `DELETE`
  - URI: `/nacos/v1/ns/instance/metadata/batch`
  - Body: JSON åŒ…å«è¦åˆ é™¤çš„å…ƒæ•°æ®é”®åˆ—è¡¨
- **é¢„æœŸå“åº”**: `200 OK`
- **éªŒè¯ç‚¹**: å…ƒæ•°æ®é”®å·²åˆ é™¤

#### æµ‹è¯•ç”¨ä¾‹ï¼šåˆ é™¤ä¸å­˜åœ¨çš„å…ƒæ•°æ®é”®
- **æµ‹è¯•å‡½æ•°å**: `test_batch_delete_instance_metadata_not_found`
- **å‰ç½®æ¡ä»¶**: æ’å…¥å®ä¾‹ï¼ˆä¸åŒ…å«è¦åˆ é™¤çš„å…ƒæ•°æ®é”®ï¼‰
- **è¯·æ±‚**: åˆ é™¤ä¸å­˜åœ¨çš„é”®
- **é¢„æœŸå“åº”**: `200 OK` æˆ– `404 Not Found`ï¼ˆæ ¹æ®å®ç°ï¼‰
- **éªŒè¯ç‚¹**: æ ¹æ®å®ç°éªŒè¯è¡Œä¸º

---

## 9. å®ä¾‹çŠ¶æ€æŸ¥è¯¢ API (`GET /v1/ns/instance/statuses`)

### 9.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ï¼šè·å–å¤šä¸ªå®ä¾‹çš„å¥åº·çŠ¶æ€
- **æµ‹è¯•å‡½æ•°å**: `test_get_instance_statuses_success`
- **å‰ç½®æ¡ä»¶**: æ’å…¥å¤šä¸ªå®ä¾‹ï¼ˆéƒ¨åˆ†å¥åº·ï¼Œéƒ¨åˆ†ä¸å¥åº·ï¼‰
- **è¯·æ±‚**: `GET /nacos/v1/ns/instance/statuses?serviceName=test-service&namespaceId=public&groupName=DEFAULT_GROUP&ips=127.0.0.1:8080,127.0.0.1:8081`
- **é¢„æœŸå“åº”**:
  - çŠ¶æ€ç : `200 OK`
  - å“åº”ä½“: JSON æ ¼å¼ï¼ŒåŒ…å«æ¯ä¸ªå®ä¾‹çš„å¥åº·çŠ¶æ€
- **éªŒè¯ç‚¹**: è¿”å›æ‰€æœ‰å®ä¾‹çš„çŠ¶æ€ä¿¡æ¯

#### æµ‹è¯•ç”¨ä¾‹ï¼šçŠ¶æ€ä¿¡æ¯å‡†ç¡®æ€§
- **æµ‹è¯•å‡½æ•°å**: `test_get_instance_statuses_accuracy`
- **å‰ç½®æ¡ä»¶**: æ’å…¥å·²çŸ¥å¥åº·çŠ¶æ€çš„å®ä¾‹
- **éªŒè¯ç‚¹**: è¿”å›çš„çŠ¶æ€ä¸å®é™…çŠ¶æ€ä¸€è‡´

---

## ğŸ“ æµ‹è¯•å®ç°æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•æ•°æ®å‡†å¤‡**:
   - ä½¿ç”¨ `TestDatabase::new()` åˆ›å»ºæµ‹è¯•æ•°æ®åº“
   - ä½¿ç”¨ `insert_test_service()` æ’å…¥æµ‹è¯•æœåŠ¡
   - ä½¿ç”¨ `insert_test_instance()` æ’å…¥æµ‹è¯•å®ä¾‹
   - ä½¿ç”¨ `insert_test_namespace()` æ’å…¥æµ‹è¯•å‘½åç©ºé—´

2. **è¯·æ±‚æ„å»º**:
   - æ³¨æ„ URL å‚æ•°çš„æ­£ç¡®æ ¼å¼
   - PUT/PATCH è¯·æ±‚éœ€è¦ JSON Body
   - å¿ƒè·³è¯·æ±‚éœ€è¦ç‰¹å®šçš„ Body æ ¼å¼

3. **å“åº”éªŒè¯**:
   - éªŒè¯çŠ¶æ€ç 
   - éªŒè¯å“åº”ä½“æ ¼å¼å’Œå†…å®¹
   - éªŒè¯æ•°æ®åº“çŠ¶æ€ï¼ˆå¯é€‰ï¼‰

4. **æ¸…ç†**:
   - ä½¿ç”¨ `test_db.cleanup()` æ¸…ç†æµ‹è¯•æ•°æ®

5. **å®ä¾‹ ID æ ¼å¼**:
   - å®ä¾‹ ID é€šå¸¸ä¸ºï¼š`{ip}#{port}#{namespace_id}#{cluster_name}`
   - æ³¨æ„å®ä¾‹çš„å”¯ä¸€æ€§ï¼ˆIP + Port + Namespace + Groupï¼‰

---

**æœ€åæ›´æ–°**: 2025-01-27

